# ğŸ—ï¸ Topologia AWS - Projeto BIA

## Arquitetura Completa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 AWS CLOUD                                       â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                            CI/CD PIPELINE                                   â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  GitHub â”€â”€â–º GitHub Actions â”€â”€â–º CodeBuild â”€â”€â–º ECR â”€â”€â–º ECS Deploy             â”‚â”‚
â”‚  â”‚     â”‚            â”‚               â”‚          â”‚         â”‚                     â”‚â”‚
â”‚  â”‚   Push         Trigger         Build      Push     Update                   â”‚â”‚
â”‚  â”‚  (main/        Workflow       Docker     Image    Service                   â”‚â”‚
â”‚  â”‚  develop)                     Image                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         COMPUTE & CONTAINER                                 â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚  â”‚   ECS CLUSTER   â”‚    â”‚   ECS CLUSTER   â”‚    â”‚      EC2        â”‚         â”‚â”‚
â”‚  â”‚  â”‚   (Production)  â”‚    â”‚   (Staging)     â”‚    â”‚   (Optional)    â”‚         â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚â”‚
â”‚  â”‚  â”‚ â”‚ BIA Service â”‚ â”‚    â”‚ â”‚ BIA Service â”‚ â”‚    â”‚ â”‚   Docker    â”‚ â”‚         â”‚â”‚
â”‚  â”‚  â”‚ â”‚ (bia-prod)  â”‚ â”‚    â”‚ â”‚(bia-staging)â”‚ â”‚    â”‚ â”‚  Container  â”‚ â”‚         â”‚â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                           STORAGE & DATA                                    â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚  â”‚      ECR        â”‚    â”‚      RDS        â”‚    â”‚ Secrets Manager â”‚         â”‚â”‚
â”‚  â”‚  â”‚   (Registry)    â”‚    â”‚   PostgreSQL    â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚ bia-production  â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚â”‚
â”‚  â”‚  â”‚ bia-staging     â”‚    â”‚ â”‚  Database   â”‚ â”‚    â”‚ â”‚ DB Secrets  â”‚ â”‚         â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚ â”‚   (t3.micro)â”‚ â”‚    â”‚ â”‚             â”‚ â”‚         â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚â”‚
â”‚  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      MONITORING & LOGGING                                  â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚  â”‚   CloudWatch    â”‚    â”‚   CloudWatch    â”‚    â”‚      SSM        â”‚         â”‚â”‚
â”‚  â”‚  â”‚     Logs        â”‚    â”‚    Metrics      â”‚    â”‚  Session Mgr    â”‚         â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚ /ecs/bia-prod   â”‚    â”‚ CPU/Memory      â”‚    â”‚ EC2 Access      â”‚         â”‚â”‚
â”‚  â”‚  â”‚ /ecs/bia-stagingâ”‚    â”‚ Health Checks   â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚ /codebuild/logs â”‚    â”‚ Build Metrics   â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         SECURITY & ACCESS                                  â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚  â”‚      IAM        â”‚    â”‚   VPC/Security  â”‚    â”‚      STS        â”‚         â”‚â”‚
â”‚  â”‚  â”‚     Roles       â”‚    â”‚     Groups      â”‚    â”‚   Tokens        â”‚         â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â”‚ CodeBuildRole   â”‚    â”‚ bia-dev-sg      â”‚    â”‚ Session Tokens  â”‚         â”‚â”‚
â”‚  â”‚  â”‚ ECSTaskRole     â”‚    â”‚ Default VPC     â”‚    â”‚ Temp Credentialsâ”‚         â”‚â”‚
â”‚  â”‚  â”‚ EC2InstanceRole â”‚    â”‚ us-east-1a      â”‚    â”‚                 â”‚         â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Fluxo de Deploy

### ğŸ”„ Pipeline AutomÃ¡tico

```
1. Developer Push
   â”œâ”€â”€ Branch: main â†’ Production
   â””â”€â”€ Branch: develop â†’ Staging

2. GitHub Actions Trigger
   â”œâ”€â”€ Configure AWS Credentials
   â”œâ”€â”€ Start CodeBuild Project
   â””â”€â”€ Monitor Build Status

3. CodeBuild Process
   â”œâ”€â”€ Pull Source Code
   â”œâ”€â”€ Docker Build (with environment args)
   â”œâ”€â”€ ECR Login & Push
   â””â”€â”€ Generate imagedefinitions.json

4. ECS Deploy
   â”œâ”€â”€ Update Service Definition
   â”œâ”€â”€ Rolling Update
   â”œâ”€â”€ Health Check
   â””â”€â”€ Complete Deployment
```

## Recursos AWS Utilizados

### ğŸ—ï¸ **Compute & Container**
- **ECS (Elastic Container Service)**
  - Cluster: `bia-cluster-production`, `bia-cluster-staging`
  - Services: `bia-production`, `bia-staging`
  - Task Definitions: `task-def-bia`

- **EC2 (Elastic Compute Cloud)**
  - Instance Type: `t3.micro`
  - AMI: `ami-02f3f602d23f1659d`
  - Role: EC2 Instance Profile with SSM

### ğŸ“¦ **Storage & Registry**
- **ECR (Elastic Container Registry)**
  - Repositories: `bia-production`, `bia-staging`
  - Image Tags: `latest`, `commit-hash`

- **RDS (Relational Database Service)**
  - Engine: PostgreSQL
  - Instance: `t3.micro`
  - Multi-AZ: No (dev environment)

### ğŸ” **Security & Access**
- **IAM (Identity and Access Management)**
  - CodeBuild Service Role
  - ECS Task Execution Role
  - EC2 Instance Profile

- **Secrets Manager**
  - Database credentials
  - Application secrets

- **STS (Security Token Service)**
  - Temporary credentials
  - Session tokens

### ğŸ“Š **Monitoring & Logging**
- **CloudWatch**
  - Logs: `/ecs/bia-production`, `/ecs/bia-staging`
  - Metrics: CPU, Memory, Health Checks
  - Build Logs: CodeBuild execution

- **SSM (Systems Manager)**
  - Session Manager for EC2 access
  - Parameter Store (optional)

### ğŸš€ **CI/CD Pipeline**
- **GitHub Actions**
  - Workflow triggers
  - AWS credential management
  - Multi-environment deployment

- **CodeBuild**
  - Projects: `bia-build-production`, `bia-build-staging`
  - Build specifications: `buildspec.yml`, `buildspec-staging.yml`
  - Environment variables

### ğŸŒ **Network**
- **VPC (Virtual Private Cloud)**
  - Default VPC
  - Availability Zone: `us-east-1a`
  - Security Groups: `bia-dev`

## Ambientes

### ğŸŸ¢ **Production**
- **Branch:** `main`
- **URL:** `https://bia-prod.exemplo.com`
- **ECR:** `bia-production`
- **ECS Service:** `bia-production`

### ğŸŸ¡ **Staging**
- **Branch:** `develop`  
- **URL:** `https://bia-staging.exemplo.com`
- **ECR:** `bia-staging`
- **ECS Service:** `bia-staging`

## Custos Estimados (us-east-1)

| ServiÃ§o | Tipo | Custo/MÃªs |
|---------|------|-----------|
| ECS | 2 services | ~$0 (apenas EC2) |
| EC2 | 2x t3.micro | ~$16.80 |
| RDS | t3.micro | ~$12.60 |
| ECR | 2 repositories | ~$1.00 |
| CloudWatch | Logs/Metrics | ~$5.00 |
| **Total** | | **~$35.40/mÃªs** |

## Scripts de AutomaÃ§Ã£o

- `deploy-ecs.sh` - Deploy manual para ECS
- `monitor-pipeline.sh` - Monitoramento de saÃºde
- `generate-sts-token.sh` - GeraÃ§Ã£o de tokens temporÃ¡rios
- `build.sh` / `deploy.sh` - Scripts por ambiente
